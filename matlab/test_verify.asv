clear; close all;

% Twitch force param %
P = 1;     % Peak force
CT = 5;    % Time to peak

file_location = '../C/test_data/';
file_name = 'res.txt';

[num_matrix, input_matrix_list, output_matrix_list] = ...
    read_test_file(strcat(file_location, file_name));
RMSE_list = zeros()
for i = 1 : num_matrix
    pulse_vector = input_matrix_list{i};
    predicted_tf_vector = output_matrix_list{i};
    DATA_LENGTH = length(input_matrix_list{i});
    
	[expected_tf_vector, tf_proto] = ...
        twitch_force_vector_gen(pulse_vector, P, CT, DATA_LENGTH);

    figure;
    subplot_helper(1:DATA_LENGTH, pulse_vector, ...
                    [4 1 1], {'sample' 'amplitude' 'pulse'}, ':x');
    subplot_helper(1:length(tf_proto), tf_proto, ...
                    [4 1 2], ...
                    {'sample' 'amplitude' 'twitch force prototype'}, ...
                    '-');
    subplot_helper(1:DATA_LENGTH, pulse_vector, ...
                    [4 1 3], {'sample' 'amplitude' 'force'}, ':x');   
    subplot_helper(1:DATA_LENGTH, expected_tf_vector, ...
                    [4 1 3], {'sample' 'amplitude' 'force'}, '-');    
    subplot_helper(1:DATA_LENGTH, predicted_tf_vector, ...
                    [4 1 3], {'sample' 'amplitude' 'force'}, '-'); 
                
    delta_matrix = predicted_tf_vector - expected_tf_vector;
    subplot_helper(1:DATA_LENGTH, delta_matrix, ...
                    [4 1 4], {'sample' 'amplitude' 'force error'}, '-'); 
    ylim([-1 1]);
end